<app-header></app-header>

<ion-content class="itemlist-page">
  <ion-refresher slot="fixed" pulling-icon="" (ionRefresh)="handleRefresh($event)">
  </ion-refresher>
  <div class="itemlist-container" (click)="onOutsideClick($event)">
    <div class="filter">
      <form class="form">
        <div class="top">
          <!-- <ion-title class="itemTitle">Items</ion-title> -->
          <div class="filterItem" (click)="$event.stopPropagation()">
            <ion-button class="btn no-style bid-now btnsearch" (click)="toggleSearch(); $event.stopPropagation()"><img src="assets/img/icons/magnifyingglass.svg" alt="" title=""></ion-button>
            <ion-item class="no-style">
              <div class="custom-inner selectId">
                <ion-select interface="popover" placeholder="Filter By" class="form-field" slot="start"
                [(ngModel)]="searchFieldControl" [ngModelOptions]="{standalone: true}" placeholder="Select Type"
                (ngModelChange)="selectFilter($event)">
                <ion-select-option [value]="1">Price (Low to High) </ion-select-option>
                <ion-select-option [value]="2">Price (High to Low)</ion-select-option>
                <ion-select-option [value]="3"> Quantity (Low to High)</ion-select-option>
                <ion-select-option [value]="4">Quantity (High to Low)</ion-select-option>
                <ion-select-option [value]="5">Most Recent</ion-select-option>
              </ion-select>
            </div>
          </ion-item>
          <ion-button class="btn no-style bid-now refresh" (click)="reloadItems()"><img src="assets/img/icons/reload.svg" alt="" title=""></ion-button>
          </div>

        </div>
        <div class="bottom" [class.show]="isSearchVisible" (click)="$event.stopPropagation()">
          <ion-item class="no-style">
            <div class="custom-inner search">
              <ion-input class="form-field" type="text" [(ngModel)]="searchKeyword"
                [ngModelOptions]="{standalone: true}" placeholder="Search" (keyup)="searchItem($event)"></ion-input>
            </div>
          </ion-item>
          <div class="close" (click)="closeSearch()"><ion-icon name="close-outline"></ion-icon></div>
        </div>
      </form>
    </div>
    <ng-container *ngIf="itemList.length>0">
      <ion-card class="rubber-card" *ngFor="let item of itemList; let i= index">

        
          <ion-card-content class="rubber-card-item">
            <swiper-container #swiperContainer pagination="true" pagination-clickable="true" slides-per-view="1"
              centered-slides="true" space-between="12" loop="true" autoplay="true" autoplay-delay="3000" style="overflow: visible;" class="itemSlider"
              id="itemsliderimage">
              
              <!-- Image slides -->
              <swiper-slide class="slide" *ngFor="let media of item.item_image; let idx = index">
                <div class="content myitemImg" style="position: relative; height: 200px; overflow: hidden;">
                  <img [src]="media" alt="" title="" (click)="openLightbox(item.item_image, idx)" (error)="onThumbnailError($event)" style="width: 100%; height: 200px; object-fit: cover;">
                  <ion-button class="btn no-style share" (click)="shareItem(item)"><img src="assets/img/icons/share.svg" alt="" title=""></ion-button>
                  <div class="verifiedBdg" *ngIf="isTrustedValid(item)"><img class="auto-flip" src="assets/img/icons/verified_user.svg" alt=""></div>
                </div>
              </swiper-slide>
              
              <!-- Video slide -->
              <swiper-slide class="slide" *ngIf="item.item_video">
                <div class="content myitemVideo" style="position: relative; height: 200px; overflow: hidden;">
                  <video #videoElement [src]="item.item_video" (error)="onVideoError($event)" style="width: 100%; height: 200px; object-fit: cover;" preload="metadata" muted>
                    Your browser does not support the video tag.
                  </video>
                  <!-- Play button overlay -->
                  <div class="video-play-overlay" (click)="openVideoLightbox(item.item_video)" 
                       style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); cursor: pointer; z-index: 10;"
                       onmouseover="this.querySelector('.play-button').style.background='rgba(0,0,0,0.9)'"
                       onmouseout="this.querySelector('.play-button').style.background='rgba(0,0,0,0.7)'">
                    <div class="play-button" 
                         style="width: 60px; height: 60px; background: rgba(0,0,0,0.7); border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; border: 2px solid white; box-shadow: 0 4px 8px rgba(0,0,0,0.3);">
                      <ion-icon name="play" style="color: white; font-size: 24px; margin-left: 4px;"></ion-icon>
                    </div>
                  </div>
                  <ion-button class="btn no-style share" (click)="shareItem(item)"><img src="assets/img/icons/share.svg" alt="" title=""></ion-button>
                  <div class="verifiedBdg" *ngIf="isTrustedValid(item)"><img class="auto-flip" src="assets/img/icons/verified_user.svg" alt=""></div>
                </div>
              </swiper-slide>

            </swiper-container>
            <div class="title-section">
              <h2>{{item.item_name}} for <span *ngIf="item.item_listed_for == 1">Sale</span> <span
                  *ngIf="item.item_listed_for == 2">Buy</span> <span *ngIf="item.city">in {{item.city}}</span></h2>
              <div class="date-location">
                <div class="location">
                  <img src="assets/img/icons/location_on_color.svg" alt="" title="" *ngIf="item.city && item.state">
                  <span *ngIf="item.city && item.state">{{item.city}}, {{item.state}}</span>
                  <!-- <span *ngIf="!item.city && !item.state">{{item.user_city}}, {{item.user_state}}</span> -->
                </div>
                <div class="date_wrap">
                  <span class="date" >Date <span *ngIf="item.added_on && !item.updated_on">{{item.added_on | date:'dd.MM.yyyy'}}</span>
                    <span *ngIf="item.added_on && item.updated_on">
                      {{item.updated_on | date:'dd.MM.yyyy'}}</span></span>
                </div>
              </div>
            </div>

            <div class="price-volume">
              <div class="item">
                <label>Selling Price</label>
                <strong>{{item.price}}/{{getUOMText(item.uom_id)}}</strong>
              </div>
              <div class="item">
                <label>Trade Volume</label>
                <strong>{{item.quantity}} {{getUOMText(item.uom_id)}}</strong>
              </div>
            </div>

            <div class="footer">
              <div class="company" (click)="showMyItems(item)">
                <div class="distributor">
                  <img [src]="item.user_image" alt="" title="" (error)="onImageError($event)"> 
                </div>
                <div class="company-info">
                  <h4 *ngIf="item.company_name">{{item.company_name}}</h4>
                  <h4 *ngIf="!item.company_name">{{item.full_name}}</h4>
                  <span *ngIf="item.item_listed_for == 1">Seller</span>
                  <span *ngIf="item.item_listed_for == 2">Buyer</span>
                </div>
              </div>
              <ion-button class="btn no-style bid-now" (click)="openBidModal(item)">Bid Now</ion-button>
            </div>
          </ion-card-content>
         


      </ion-card>
      <ion-infinite-scroll threshold="100px" (ionInfinite)="loadData($event)" *ngIf="totalCount!=itemList.length">
        <ion-infinite-scroll-content loadingSpinner="bubbles">
        </ion-infinite-scroll-content>
      </ion-infinite-scroll>
    </ng-container>

    <div class="app-customers" *ngIf="itemList.length==0 && showNoRecord">
      <p class="ion-text-center mt-5">-- No data found --</p>
    </div>

  </div>

</ion-content>

<app-footer></app-footer>
